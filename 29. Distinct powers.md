## **[29. Distinct powers](https://projecteuler.net/problem=29)**

### Question
How many distinct terms are in the sequence generated by ![eq](https://latex.codecogs.com/gif.latex?a^b) for 2 ≤ a ≤ 100 and 2 ≤ b ≤ 100?

### Solution
```python
def p29(N = 100):
    return len(set(a ** b for a in range(2, N + 1) for b in range(2, N + 1)))
```

### Answer 
`9183`

### [Hackerrank Project Euler #29](https://www.hackerrank.com/contests/projecteuler/challenges/euler029/problem) 
How many distinct terms are in the sequence generated by ![eq](https://latex.codecogs.com/gif.latex?a^b) for 2 ≤ a ≤ N and 2 ≤ b ≤ N?

Constraints:
- `2 <= N <= 10^5`

The above brute force solution only works fine when N is small. It takes around 10 seconds to get an answer when N = 1000, which is unbearable. 

Apparently, it is much faster to find out the number of duplicates. Then the answer is the difference between the total number of the powers ![eq](https://latex.codecogs.com/gif.latex?(N-1)^2) and the number of duplicates. 

A power ![eq](https://latex.codecogs.com/gif.latex?a^b) is a duplicate of another if ![eq](https://latex.codecogs.com/gif.latex?a) is a square, a cube or a n-th power. For example, ![eq](https://latex.codecogs.com/gif.latex?4^2) is a duplicate of ![eq](https://latex.codecogs.com/gif.latex?2^4); ![eq](https://latex.codecogs.com/gif.latex?8^2) is a duplicate of ![eq](https://latex.codecogs.com/gif.latex?4^3)

In general, if ![eq](https://latex.codecogs.com/gif.latex?a) is a n-th power, then there exists an integer ![eq](https://latex.codecogs.com/gif.latex?c) such that ![eq](https://latex.codecogs.com/gif.latex?c=a^{k/n},&space;\textrm{where&space;}&space;k=1,...,n-1)

That is, ![eq](https://latex.codecogs.com/gif.latex?a=c^{n/k}). Therefore, ![eq](https://latex.codecogs.com/gif.latex?a^{mk}) is a duplicate of ![eq](https://latex.codecogs.com/gif.latex?c^{mn}), i.e. ![eq](https://latex.codecogs.com/gif.latex?a^{mk}=c^{mn},&space;\textrm{where&space;}&space;1\leqslant&space;m\leqslant&space;N/n)


```python
from math import sqrt, log2
from collections import defaultdict

def p29(N):
    d = defaultdict(list)
    for x in range(2, int(sqrt(N)) + 1):        # x: base number
        for n in range(2, int(log2(N)) + 1):    # n: power
            a = x ** n                          # a: n-th power
            if a > N: break
            d[a].append(n)

    dup_cnt = 0
    for a in d.keys():
        power = set()
        for n in d[a]:
            for k in range(1, n):
                for m in range(1, N // n + 1):
                    if m * k == 1: continue
                    power.add(m * k)
        dup_cnt += len(power)
    return (N - 1) ** 2 - dup_cnt
```
