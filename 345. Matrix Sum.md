## **[345. Matrix Sum](https://projecteuler.net/problem=345)**

### Question
We define the Matrix Sum of a matrix as the maximum possible sum of matrix elements such that 
none of the selected elements share the same row or column.

For example, the Matrix Sum of the matrix below equals 3315 ( = 863 + 383 + 343 + 959 + 767):

![im](./images/p345_1.png)

Find the Matrix Sum of:

![im](./images/p345_2.png)

### Solution

```python
m = [[int(y) for y in x.split()] for x in s.split('\n')]
n = len(m)

from itertools import permutations

ans = 0
for p in permutations(range(n)):
    t = sum(m[row][col] for row, col in enumerate(p))
    ans = max(ans, t)
print(ans)
```

#### Slow (~3.25s)

```python
from typing import Tuple

def p345():
    def f(cols: Tuple, cur_sum: int):
        if cols in d and d[cols] > cur_sum:
            return

        d[cols] = cur_sum

        row = n - len(cols)
        for i, col in enumerate(cols):
            f(cols[:i] + cols[i+1:], cur_sum + m[row][col])

    d = {}
    f(tuple(range(n)), 0)
    return d[()]
```

#### Fast (~0.25s)

```python
def p345_dp():
    d = [0 for i in range(1 << n)]
    previous_states = [0]
    for row in range(n):
        new_states = set()
        for state in previous_states:
            for col in range(n):
                if state & (1 << col) == 0:
                    new_state = state | (1 << col)
                    new_states.add(new_state)
                    d[new_state] = max(d[new_state], d[state] + m[row][col])
        previous_states = new_states
    return d[-1]
```

### Answer 
`13938`

### Bonus 
```python
from scipy.optimize import linear_sum_assignment

rows, cols = linear_sum_assignment(m, maximize=True)
ans = sum(m[r][c] for r, c in zip(rows, cols))
print(ans)
```

